<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="plutonium-chart-behavior.html">

<!--
`plutonium-line-chart`
Visualization widget.

@demo demo/index-line-chart.html 
-->

<dom-module id="plutonium-line-chart">
    <template>
        <style>
            :host {
                display: block;
                height: 400px;
            }
            text {
                fill: white;
            }
            .controls {
                display: inline-block;
                margin: 0 0 0 20px;
            }
            svg {
                float: right;
                margin: 0;
            }
            .axis--x path {
                display: none;
            }

            .line {
                fill: none;
                stroke: steelblue;
                stroke-width: 1.5px;
            }
        </style>
        <!--        <div class="controls">
                    <template is="dom-repeat" items="{{data}}" as="d">
                        <p>A
                            <label for="input">{{d.type}}: </label>
                            <input id="input"
                                   type="range"
                                   value="{{d.amount}}"
                                   min="0" max="500" />
                            <span>[[d.amount]]</span>
                        </p>
                    </template>
                </div>-->
        <svg id="svg"></svg>
    </template>

    <script>
        Polymer({
            is: 'plutonium-line-chart',
            extends: 'div',
            properties: {
            },
            behaviors: [
                Plutonium.ChartBehavior
            ],
            createElements: function (width, height) {
                console.debug(this.is, 'create elements');

                this.margin = {top: 20, right: 20, bottom: 30, left: 50};

                this.width = width;
                this.height = height;

                this.x = d3.scaleTime().rangeRound([0, width]);

                this.y = d3.scaleLinear().rangeRound([height, 0]);

                var self = this;
                this.line = d3.line().x(function (d) {
                    return self.x(d.date);
                }).y(function (d) {
                    return self.y(d.close);
                });

                this.svg = d3.select(this.$.svg)
                        .attr("width", width)
                        .attr("height", height)
                        .append("g")
                        .attr("transform", "translate(" + this.margin.left + "," + this.margin.top + ")");
            },
            drawChart: function () {
                console.debug(this.is, 'draw chart');
                var me = this;

                if (this.g)
                    this.g.remove();

                this.x.domain(d3.extent(this.data, function (d) {
                    return d.date;
                }));
                this.y.domain(d3.extent(this.data, function (d) {
                    return d.close;
                }));

                this.g = this.svg.append("g");

                this.g.append("g")
                        .attr("class", "axis axis--x")
                        .attr("transform", "translate(0," + this.height + ")")
                        .call(d3.axisBottom(this.x));

                this.g.append("g")
                        .attr("class", "axis axis--y")
                        .call(d3.axisLeft(this.y))
                        .append("text")
                        .attr("fill", "#000")
                        .attr("transform", "rotate(-90)")
                        .attr("y", 6)
                        .attr("dy", "0.71em")
                        .style("text-anchor", "end")
                        .text("Price ($)");

                this.g.append("path")
                        .datum(this.data)
                        .attr("class", "line")
                        .attr("d", this.line);

            },
            refreshChart: function (g, data) {
                console.debug(this.is, 'refresh chart');

//                if (!this.data) {
//                    this.getData();
//                }
                //                if (!this.g) {
                //                    this.drawChart();
                //                }
                //
                //                if (this.data) {
                //                    var me = this;
                //
                //                    this.g.data(this.pie(this.data)).select("path").attr("d", this.arc);
                //
                //                    this.g.select("text").attr("transform", function (d) {
                //                        return "translate(" + me.arc.centroid(d) + ")";
                //                    });
                //                }
            }
        });
    </script>
</dom-module>
