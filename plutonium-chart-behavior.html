<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">

<script src="../d3/d3.js"></script>

<script>
    window.Plutonium = window.Plutonium || {};
    /**
     * Behavior that highlights stuff.
     *
     * @polymerBehavior
     */
    Plutonium.ChartBehaviorImpl = {
        extends: 'div',
        properties: {
            _viewport: {
                type: Object,
                notify: true
            },
            _margin: {
                type: Object,
                notify: true,
                value: {
                    top: 20,
                    right: 20,
                    bottom: 30,
                    left: 50
                }
            },
            _width: {
                type: Number,
                computed: '_computeContentWidth(_viewport.width, _margin.left, _margin.right)'
            },
            _height: {
                type: Number,
                computed: '_computeContentHeight(_viewport.height, _margin.top, _margin.bottom)'
            }
        },
        observers: [
            '_observeLayout(_viewport, _margin)'
        ],
        listeners: {
            'iron-resize': '_onResize',
            'plutonium-render': '_onRender'
        },
        created: function () {
            console.debug((this.id ? this.is + '#' + this.id : this.is), 'created');
        },
        ready: function () {
            this._svg = d3.select(this.$.container);
            console.debug((this.id ? this.is + '#' + this.id : this.is), 'ready');
        },
        attached: function () {
            console.debug((this.id ? this.is + '#' + this.id : this.is), 'attached');
        },
        detached: function () {
            console.debug((this.id ? this.is + '#' + this.id : this.is), 'detached');
        },
        _onResize: function (event, details) {
            if (this.offsetWidth > 0 && this.offsetHeight > 0) {
                this._viewport = {
                    width: this.offsetWidth,
                    height: this.offsetHeight
                };
                console.log((this.id ? this.is + '#' + this.id : this.is), 'resized to', this._viewport);
            }
            this.draw();
        },
        _observeLayout: function (viewport, margin) {
            console.debug((this.id ? this.is + '#' + this.id : this.is), 'observe-layout', viewport, margin);
            this._svg = this._svg.attr('width', this._viewport.width).attr('height', this._viewport.height);
            if (this._g)
                this._g.remove();
            this._g = this._svg.append("g").attr("transform", "translate(" + this._margin.left + "," + this._margin.top + ")");
        },
        _computeContentWidth: function (viewportWidth, marginLeft, marginRight) {
            return viewportWidth - marginLeft - marginRight;
        },
        _computeContentHeight: function (viewportHeight, marginTop, marginBottom) {
            return viewportHeight - marginTop - marginBottom;
        },
        _onRender: function (chart, x, y) {
            this.draw();
        },
        draw: function () {
            console.debug((this.id ? this.is + '#' + this.id : this.is), 'draw should be overridden');
        }
    };
    /**
     * Behavior that highlights stuff.
     *
     * @polymerBehavior
     */
    Plutonium.ChartBehavior = [
        Polymer.IronResizableBehavior,
        Plutonium.ChartBehaviorImpl
    ];
</script>